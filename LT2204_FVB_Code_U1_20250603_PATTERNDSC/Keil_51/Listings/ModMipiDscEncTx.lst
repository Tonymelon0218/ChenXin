C51 COMPILER V9.60.0.0   MODMIPIDSCENCTX                                                   11/21/2025 11:27:23 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MODMIPIDSCENCTX
OBJECT MODULE PLACED IN .\Objects\ModMipiDscEncTx.obj
COMPILER INVOKED BY: D:\DevTools\Keil_5\Keil_v5\C51\BIN\C51.EXE ..\User\L1_Module\ModMipiDscEncTx.c LARGE OBJECTADVANCED
                    - OPTIMIZE(11,SIZE) REGFILE(.\Objects\LT6911GXD_Pattern_MIPI_C-PHY_2D_NoBurst_2160x2160@120_251121_02.ORC) BROWSE INCDIR(
                    -..\User\L0_App;..\User\L1_Module;..\User\L2_Drive;..\User\L3_Ocm) DEBUG PRINT(.\Listings\ModMipiDscEncTx.lst) OBJECT(.\O
                    -bjects\ModMipiDscEncTx.obj)

line level    source

   1          /******************************************************************************
   2            * @project: LT2204
   3            * @file: ModMipiDscEncTx.c
   4            * @author: wtt
   5            * @company: LONTIUM
   6            * @date: 2022.05.26
   7          /******************************************************************************/
   8          #include "include.h"
   9          
  10          #if TX_PORT_SIGN == MIPI_PORT
  11          #if MIPITX_DSC == ENABLED
  12          
  13          code u8 ucuzEncPPS[128] = {
  14              // 2160x2160@90         0x30
  15              0x11, 0x00, 0x00, 0x89, 0x30, 0x80, 0x08, 0x70, 0x08, 0x70, 0x00, 0x10, 0x02, 0x1C, 0x02, 0x1C,
  16              0x02, 0x00, 0x02, 0x0E, 0x00, 0x20, 0x01, 0x84, 0x00, 0x07, 0x00, 0x0C, 0x06, 0x67, 0x06, 0x5C,
  17              0x18, 0x00, 0x10, 0xF0, 0x03, 0x0C, 0x20, 0x00, 0x06, 0x0B, 0x0B, 0x33, 0x0E, 0x1C, 0x2A, 0x38,
  18              0x46, 0x54, 0x62, 0x69, 0x70, 0x77, 0x79, 0x7B, 0x7D, 0x7E, 0x01, 0x02, 0x01, 0x00, 0x09, 0x40,
  19              0x09, 0xBE, 0x19, 0xFC, 0x19, 0xFA, 0x19, 0xF8, 0x1A, 0x38, 0x1A, 0x78, 0x1A, 0xB6, 0x2A, 0xF6,
  20              0x2B, 0x34, 0x2B, 0x74, 0x3B, 0x74, 0x6B, 0xF4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00,
  21              0x00, 0x89, 0x30, 0x80, 0x08, 0x70, 0x08, 0x70, 0x00, 0x10, 0x02, 0x1C, 0x02, 0x1C, 0x03, 0x52,
  22              0x02, 0x0E, 0x00, 0x20, 0x00, 0x00, 0x00, 0x07, 0x00, 0x0C, 0x06, 0x67, 0x06, 0x5C, 0x18, 0x00
  23          
  24              // 4320x2160@90                     0x08, 0x70, 0x08, 0x70
  25              // 0x11, 0x00, 0x00, 0x89, 0x10, 0x80, 0x08, 0x70, 0x10, 0xE0, 0x00, 0x10, 0x02, 0x1C, 0x02, 0x1C,
  26              // 0x02, 0x00, 0x02, 0x0E, 0x00, 0x20, 0x01, 0x84, 0x00, 0x07, 0x00, 0x0C, 0x06, 0x67, 0x06, 0x5C,
  27              // 0x18, 0x00, 0x10, 0xF0, 0x03, 0x0C, 0x20, 0x00, 0x06, 0x0B, 0x0B, 0x33, 0x0E, 0x1C, 0x2A, 0x38,
  28              // 0x46, 0x54, 0x62, 0x69, 0x70, 0x77, 0x79, 0x7B, 0x7D, 0x7E, 0x01, 0x02, 0x01, 0x00, 0x09, 0x40,
  29              // 0x09, 0xBE, 0x19, 0xFC, 0x19, 0xFA, 0x19, 0xF8, 0x1A, 0x38, 0x1A, 0x78, 0x1A, 0xB6, 0x2A, 0xF6,
  30              // 0x2B, 0x34, 0x2B, 0x74, 0x3B, 0x74, 0x6B, 0xF4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00,
  31              // 0x00, 0x89, 0x30, 0x80, 0x08, 0x70, 0x08, 0x70, 0x00, 0x10, 0x02, 0x1C, 0x02, 0x1C, 0x03, 0x52,
  32              // 0x02, 0x0E, 0x00, 0x20, 0x00, 0x00, 0x00, 0x07, 0x00, 0x0C, 0x06, 0x67, 0x06, 0x5C, 0x18, 0x00
  33          };
  34          
  35          void Mod_MipiTxDscEnc_PpsParaInit()
  36          {
  37   1          memset(&g_stMipiTxDscEncConfig, 0, sizeof(DSCConfig_Stru));
  38   1          g_stMipiTxDscEncConfig.ucSliceNum = 4;  // 2D->4; 3D->8
  39   1          g_stMipiTxDscEncConfig.ucDscNumber = 4; // 2D->4; 3D->8
  40   1          g_stMipiTxDscEncConfig.ucExtraHact = 0;
  41   1          g_stMipiTxDscEncConfig.ucColorDepth = BPC8;
  42   1          g_stMipiTxDscEncConfig.ucCompressRatio = 3;
  43   1          g_stMipiTxDscEncConfig.ucOutBpp = 8;
  44   1          g_stMipiTxDscEncConfig.usSliceHeight = ((u16)ucuzEncPPS[10] << 8) + ucuzEncPPS[11];
  45   1          g_stMipiTxDscEncConfig.usSliceWidth = ((u16)ucuzEncPPS[12] << 8) + ucuzEncPPS[13];
  46   1          g_stMipiTxDscEncConfig.usChunkSize = ((u16)ucuzEncPPS[14] << 8) + ucuzEncPPS[15];
  47   1          LTLog(LOG_DEBUG, "DscEnc Slice = %bd,CompressRatio = %bd", g_stMipiTxDscEncConfig.ucSliceNum, g_stMipi
             -TxDscEncConfig.ucCompressRatio);
  48   1          LTLog(LOG_DEBUG, "DscEnc SliceHeight = %d,SliceWidth = %d,ChunkSize = %d", g_stMipiTxDscEncConfig.usSl
             -iceHeight, g_stMipiTxDscEncConfig.usSliceWidth, g_stMipiTxDscEncConfig.usChunkSize);
  49   1      }
  50          
C51 COMPILER V9.60.0.0   MODMIPIDSCENCTX                                                   11/21/2025 11:27:23 PAGE 2   

  51          void Mod_MipiTxDscEnc_Clk_Chk(void)
  52          {
  53   1          u32 TempClock;
  54   1      
  55   1          Drv_System_FmSet(TOP_FM, 0x0F);
  56   1          Ocm_Delay1ms(5);
  57   1          TempClock = Drv_System_FmGet(TOP_FM, 0);
  58   1          LTLog(LOG_INFO, "Ad_csctx_half_pix_clk = %lukhz", TempClock);
  59   1      
  60   1          Drv_System_FmSet(TOP_FM, 0x12);
  61   1          Ocm_Delay1ms(5);
  62   1          TempClock = Drv_System_FmGet(TOP_FM, 0);
  63   1          LTLog(LOG_INFO, "Ad_dsctx_dsc_rd_clk = %lukhz", TempClock);
  64   1      
  65   1          Drv_System_FmSet(TOP_FM, 0x13);
  66   1          Ocm_Delay1ms(50);
  67   1          TempClock = Drv_System_FmGet(TOP_FM, 0);
  68   1          LTLog(LOG_INFO, "Ad_dsctx_dsc_clk = %lukhz", TempClock);
  69   1      
  70   1          Drv_System_FmSet(TOP_FM, 0x14);
  71   1          Ocm_Delay1ms(5);
  72   1          TempClock = Drv_System_FmGet(TOP_FM, 0);
  73   1          LTLog(LOG_INFO, "Ad_dsctx_dsc_out_clk = %lukhz", TempClock);
  74   1      }
  75          
  76          void Mod_MipiTxDscEnc_ModuleEnable(void)
  77          {
  78   1          Drv_MipiTxDscEnc_DataMux();
  79   1      #if (MIPITX_VID_PATTERN_MODE != NO_PATTERN)
  80   1          Drv_MipiTxDscEnc_ClkMuxForPattern();
  81   1      #else
                  Drv_MipiTxDscEnc_ClkMux();
              #endif
  84   1          Drv_MipiTxDscEnc_RxParamSet();
  85   1          Drv_MipiTxDscEnc_ExtraHactSet();
  86   1          Drv_MipiTxDscEnc_TimingSet();
  87   1          Drv_MipiTxDscEnc_MuxWordDly();
  88   1          Drv_MipiTxDscEnc_PpsSet(ucuzEncPPS);
  89   1          Drv_MipiTxDscEnc_ColorSpaceSet();
  90   1          Drv_MipiTxDscEnc_PpsDynamicSet();
  91   1          Drv_MipiTxDscEnc_ParamSet();
  92   1      }
  93          
  94          void Mod_MipiTxDscEnc_Config()
  95          {
  96   1      #if (MIPITX_VID_PATTERN_MODE != NO_PATTERN)
  97   1          Drv_MipiTxDscEnc_InitForPattern();
  98   1      #else
                  Drv_MipiTxDscEnc_Init();
              #endif
 101   1          Mod_MipiTxDscEnc_PpsParaInit();
 102   1          Drv_MipiTxDscEnc_InfoGet();
 103   1          Mod_MipiTxDscEnc_ModuleEnable();
 104   1          Mod_MipiTxDscEnc_Clk_Chk();
 105   1      }
 106          
 107          #endif
 108          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    444    ----
C51 COMPILER V9.60.0.0   MODMIPIDSCENCTX                                                   11/21/2025 11:27:23 PAGE 3   

   CONSTANT SIZE    =    338    ----
   XDATA SIZE       =   ----       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
